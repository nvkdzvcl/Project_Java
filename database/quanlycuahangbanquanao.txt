-- Tạo cơ sở dữ liệu
CREATE DATABASE IF NOT EXISTS `QLCUAHANGQUANAO`;
USE `QLCUAHANGQUANAO`;

-- BẢNG KHÁCH HÀNG
CREATE TABLE IF NOT EXISTS `KHACHHANG` (
    `MAKH` INT NOT NULL AUTO_INCREMENT,
    `TENKHACHHANG` VARCHAR(30) NOT NULL,
    `DIACHI` VARCHAR(100) NOT NULL,
    `EMAIL` VARCHAR(25) NOT NULL,
    `SDT` VARCHAR(15) UNIQUE,
    PRIMARY KEY (`MAKH`),
    UNIQUE KEY `EMAIL_UNIQUE` (`EMAIL`)
);

-- Bảng THƯƠNG HIỆU
CREATE TABLE IF NOT EXISTS `THUONGHIEU` (
    `MATHUONGHIEU` INT NOT NULL AUTO_INCREMENT,
    `TENTHUONGHIEU` VARCHAR(25) NOT NULL,
    PRIMARY KEY (`MATHUONGHIEU`),
    UNIQUE KEY `TENTHUONGHIEU_UNIQUE` (`TENTHUONGHIEU`)
);

-- BẢNG QUẦN ÁO
CREATE TABLE IF NOT EXISTS `QUANAO` (
    `MASP` INT NOT NULL AUTO_INCREMENT,
    `TENSP` VARCHAR(30) NOT NULL,
    `XUATXU` VARCHAR(15) NOT NULL,
    `MAUSAC` VARCHAR(10) NOT NULL,
    `SOLUONG` INT NOT NULL,
    `MATHUONGHIEU` INT NOT NULL,
    PRIMARY KEY (`MASP`),
    FOREIGN KEY (`MATHUONGHIEU`) REFERENCES `THUONGHIEU` (`MATHUONGHIEU`)
);

-- BẢNG NHÂN VIÊN
CREATE TABLE IF NOT EXISTS `NHANVIEN` (
    `MANV` INT NOT NULL AUTO_INCREMENT,
    `HOTENNV` VARCHAR(30) NOT NULL,
    `GIOITINH` VARCHAR(3) DEFAULT 'NAM',
    `NGAYSINH` DATETIME DEFAULT CURRENT_TIMESTAMP,
    `EMAIL` VARCHAR(25) NOT NULL,
    PRIMARY KEY (`MANV`),
    UNIQUE KEY `EMAIL_UNIQUE_NV` (`EMAIL`)
);

-- BẢNG PHIẾU KIỂM KÊ 
CREATE TABLE IF NOT EXISTS `PHIEUKIEMKE` (
    `MAPHIEUKIEMKE` INT NOT NULL AUTO_INCREMENT,
    `THOIGIAN` DATETIME DEFAULT CURRENT_TIMESTAMP,
    `TRANGTHAI` INT DEFAULT 0,
    `MANV` INT NOT NULL,
    PRIMARY KEY (`MAPHIEUKIEMKE`),
    FOREIGN KEY (`MANV`) REFERENCES `NHANVIEN` (`MANV`)
);

-- BẢNG CHI TIẾT PHIẾU KIỂM KÊ
CREATE TABLE IF NOT EXISTS `CTPHIEUKIEMKE` (
    `MAPHIEUKIEMKE` INT NOT NULL,
    `MASP` INT NOT NULL,
    `SOLUONGTHUCTE` INT NOT NULL,
    `CHENHLECH` INT NOT NULL,
    `GHICHU` VARCHAR(255),
    PRIMARY KEY (`MAPHIEUKIEMKE`, `MASP`),
    FOREIGN KEY (`MAPHIEUKIEMKE`) REFERENCES `PHIEUKIEMKE` (`MAPHIEUKIEMKE`),
    FOREIGN KEY (`MASP`) REFERENCES `QUANAO` (`MASP`)
);

-- BẢNG PHIẾU
CREATE TABLE IF NOT EXISTS `PHIEU` (
    `MAPHIEU` INT NOT NULL AUTO_INCREMENT,
    `THOIGIAN` DATETIME DEFAULT CURRENT_TIMESTAMP,
    `TRANGTHAI` INT NOT NULL,
    PRIMARY KEY (`MAPHIEU`)
);

-- BẢNG CHI TIẾT PHIẾU
CREATE TABLE IF NOT EXISTS `CTPHIEU` (
    `MAPHIEU` INT NOT NULL,
    `MASP` INT NOT NULL,
    `DONGIA` INT NOT NULL,
    `SOLUONG` INT NOT NULL,
    PRIMARY KEY (`MAPHIEU`, `MASP`),
    FOREIGN KEY (`MAPHIEU`) REFERENCES `PHIEU` (`MAPHIEU`),
    FOREIGN KEY (`MASP`) REFERENCES `QUANAO` (`MASP`)
);

-- BẢNG NHÀ CUNG CẤP
CREATE TABLE IF NOT EXISTS `NHACUNGCAP` (
    `MANHACUNGCAP` INT NOT NULL AUTO_INCREMENT,
    `TENNHACUNGCAP` VARCHAR(30) NOT NULL,
    `DIACHI` VARCHAR(100) NOT NULL,
    PRIMARY KEY (`MANHACUNGCAP`)
);

-- BẢNG PHIẾU NHẬP
CREATE TABLE IF NOT EXISTS `PHIEUNHAP` (
    `MAPHIEU` INT NOT NULL AUTO_INCREMENT,
    `THOIGIAN` DATETIME DEFAULT CURRENT_TIMESTAMP,
    `TRANGTHAI` INT NOT NULL,
    `MANHACUNGCAP` INT NOT NULL,
    PRIMARY KEY (`MAPHIEU`),
    FOREIGN KEY (`MANHACUNGCAP`) REFERENCES `NHACUNGCAP` (`MANHACUNGCAP`)
);

-- BẢNG PHIẾU ĐẶT
CREATE TABLE IF NOT EXISTS `PHIEUDAT` (
    `MAPHIEU` INT NOT NULL AUTO_INCREMENT,
    `THOIGIAN` DATETIME DEFAULT CURRENT_TIMESTAMP,
    `TRANGTHAI` INT NOT NULL,
    `MANHACUNGCAP` INT NOT NULL,
    PRIMARY KEY (`MAPHIEU`),
    FOREIGN KEY (`MANHACUNGCAP`) REFERENCES `NHACUNGCAP` (`MANHACUNGCAP`)
);

-- BẢNG ĐƠN HÀNG
CREATE TABLE IF NOT EXISTS `DONHANG` (
    `MAPHIEU` INT NOT NULL AUTO_INCREMENT,
    `THOIGIAN` DATETIME DEFAULT CURRENT_TIMESTAMP,
    `TRANGTHAI` INT NOT NULL,
    `MAKH` INT NOT NULL,
    PRIMARY KEY (`MAPHIEU`),
    FOREIGN KEY (`MAKH`) REFERENCES `KHACHHANG` (`MAKH`)
);


-- BẢNG TÀI KHOẢN
CREATE TABLE IF NOT EXISTS `TAIKHOAN` (
    `MANV` INT NOT NULL,
    `TENNGUOIDUNG` VARCHAR(30) NOT NULL,
    PRIMARY KEY (`MANV`),
    FOREIGN KEY (`MANV`) REFERENCES `NHANVIEN` (`MANV`),
    UNIQUE KEY `USERNAME_UNIQUE` (`TENNGUOIDUNG`)
);

-- BẢNG LOẠI NV
CREATE TABLE IF NOT EXISTS `LOAINV` (
    `MALOAINV` INT NOT NULL AUTO_INCREMENT,
    `MANV` INT NOT NULL,
    `TENLOAINV` VARCHAR(15) NOT NULL,
    PRIMARY KEY (`MALOAINV`),
    FOREIGN KEY (`MANV`) REFERENCES `NHANVIEN` (`MANV`)
);

-- BẢNG CHỨC NĂNG
CREATE TABLE IF NOT EXISTS `CHUCNANG` (
    `MACHUCNANG` INT NOT NULL AUTO_INCREMENT,
    `TENCHUCNNANG` VARCHAR(40) NOT NULL,
    PRIMARY KEY (`MACHUCNANG`)
);
