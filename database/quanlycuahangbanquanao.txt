-- TẠO CƠ SỞ DỮ LIỆU
DROP DATABASE IF EXISTS `quanlycuahangbanquanao`;
CREATE DATABASE `quanlycuahangbanquanao`;
USE `QLCUAHANGQUANAO`;

-- BẢNG NHÂN VIÊN (phải tạo trước vì các bảng khác dùng MANV làm khóa ngoại)
CREATE TABLE IF NOT EXISTS `NHANVIEN` (
	`MANV` INT NOT NULL AUTO_INCREMENT,
	`HOTENNV` VARCHAR(50) NOT NULL,
	`GIOITINH` VARCHAR(3) DEFAULT 'NAM',
	`NGAYSINH` DATE DEFAULT (CURDATE()),
	`SDT` CHAR(10) NOT NULL,
	`EMAIL` VARCHAR(25) NOT NULL,
	`TRANGTHAI` INT NOT NULL DEFAULT 1,
	PRIMARY KEY (`MANV`),
	UNIQUE (`SDT`),
	UNIQUE (`EMAIL`)
);

-- NHÀ CUNG CẤP
CREATE TABLE IF NOT EXISTS `NHACUNGCAP` (
	`MANHACUNGCAP` INT NOT NULL AUTO_INCREMENT,
	`TENNHACUNGCAP` VARCHAR(50) NOT NULL,
	`DIACHI` VARCHAR(255) NOT NULL,
	PRIMARY KEY (`MANHACUNGCAP`)
);

-- KHÁCH HÀNG
CREATE TABLE IF NOT EXISTS `KHACHHANG` (
	`MAKHACHHANG` INT NOT NULL AUTO_INCREMENT,
	`TENKHACHHANG` VARCHAR(50) NOT NULL,
	`DIACHI` VARCHAR(100) NOT NULL,
	`SDT` CHAR(10) NOT NULL,
	`EMAIL` VARCHAR(25) NOT NULL,
	`TRANGTHAI` INT NOT NULL DEFAULT 1,
	PRIMARY KEY (`MAKHACHHANG`),
	UNIQUE (`SDT`),
	UNIQUE (`EMAIL`)
);

-- SẢN PHẨM
CREATE TABLE IF NOT EXISTS `SANPHAM` (
	`MASP` INT NOT NULL AUTO_INCREMENT,
	`TENSP` VARCHAR(50) NOT NULL,
	`THUONGHIEU` VARCHAR(50) NOT NULL,
	`XUATXU` VARCHAR(30) NOT NULL,
	`MAUSAC` VARCHAR(10) NOT NULL,
	`KICHTHUOC` VARCHAR(5) NOT NULL,
	`SOLUONG` INT NOT NULL,
	`TRANGTHAI` INT NOT NULL DEFAULT 1,
	PRIMARY KEY (`MASP`)
);

-- PHIẾU KIỂM KÊ
CREATE TABLE IF NOT EXISTS `PHIEUKIEMKE` (
	`MAPHIEUKIEMKE` INT NOT NULL AUTO_INCREMENT,
	`THOIGIAN` DATE DEFAULT (CURDATE()),
	`TRANGTHAI` INT NOT NULL DEFAULT 1,
	`MANV` INT NOT NULL,
	PRIMARY KEY (`MAPHIEUKIEMKE`),
	FOREIGN KEY (`MANV`) REFERENCES `NHANVIEN` (`MANV`)
);

-- CHI TIẾT PHIẾU KIỂM KÊ
CREATE TABLE IF NOT EXISTS `CTPHIEUKIEMKE` (
	`MAPHIEUKIEMKE` INT NOT NULL,
	`MASP` INT NOT NULL,
	`SOLUONGTHUCTE` INT NOT NULL,
	`CHENHLECH` INT NOT NULL,
	`GHICHU` VARCHAR(255),
	PRIMARY KEY (`MAPHIEUKIEMKE`, `MASP`),
	FOREIGN KEY (`MAPHIEUKIEMKE`) REFERENCES `PHIEUKIEMKE` (`MAPHIEUKIEMKE`),
	FOREIGN KEY (`MASP`) REFERENCES `SANPHAM` (`MASP`)
);

-- PHIẾU NHẬP
CREATE TABLE IF NOT EXISTS `PHIEUNHAP` (
	`MAPHIEUNHAP` INT NOT NULL AUTO_INCREMENT,
	`THOIGIAN` DATE DEFAULT (CURDATE()),
	`TRANGTHAI` INT NOT NULL,
	`MANHACUNGCAP` INT NOT NULL,
	PRIMARY KEY (`MAPHIEUNHAP`),
	FOREIGN KEY (`MANHACUNGCAP`) REFERENCES `NHACUNGCAP` (`MANHACUNGCAP`)
);

-- CHI TIẾT PHIẾU NHẬP
CREATE TABLE IF NOT EXISTS `CTPHIEUNHAP` (
	`MAPHIEUNHAP` INT NOT NULL,
	`MASP` INT NOT NULL,
	`DONGIA` INT NOT NULL,
	`SOLUONG` INT NOT NULL,
	PRIMARY KEY (`MAPHIEUNHAP`, `MASP`),
	FOREIGN KEY (`MAPHIEUNHAP`) REFERENCES `PHIEUNHAP` (`MAPHIEUNHAP`),
	FOREIGN KEY (`MASP`) REFERENCES `SANPHAM` (`MASP`)
);

-- ĐƠN HÀNG
CREATE TABLE IF NOT EXISTS `DONHANG` (
	`MADONHANG` INT NOT NULL AUTO_INCREMENT,
	`THOIGIAN` DATE DEFAULT (CURDATE()),
	`TRANGTHAI` INT NOT NULL,
	`DIACHI` VARCHAR(255) NOT NULL,
	`MAKHACHHANG` INT NOT NULL,
	PRIMARY KEY (`MADONHANG`),
	FOREIGN KEY (`MAKHACHHANG`) REFERENCES `KHACHHANG` (`MAKHACHHANG`)
);

-- CHI TIẾT ĐƠN HÀNG
CREATE TABLE IF NOT EXISTS `CTDONHANG` (
	`MADONHANG` INT NOT NULL,
	`MASP` INT NOT NULL,
	`DONGIA` INT NOT NULL,
	`SOLUONG` INT NOT NULL,
	PRIMARY KEY (`MADONHANG`, `MASP`),
	FOREIGN KEY (`MADONHANG`) REFERENCES `DONHANG` (`MADONHANG`),
	FOREIGN KEY (`MASP`) REFERENCES `SANPHAM` (`MASP`)
);

-- TÀI KHOẢN
CREATE TABLE `TAIKHOAN` (
    `TENNGUOIDUNG` VARCHAR(20) NOT NULL,
    `MATKHAU` VARCHAR(20) NOT NULL,
    `CHUCVU` VARCHAR(10) NOT NULL,
    `TRANGTHAI` INT NOT NULL DEFAULT 1, -- 1: Hoạt động, 0: Đang khoá
    `MANV` INT NOT NULL,
    PRIMARY KEY (`TENNGUOIDUNG`),
    FOREIGN KEY (`MANV`) REFERENCES `NHANVIEN`(`MANV`)
);